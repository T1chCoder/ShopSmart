{% load my_tags %}
<div class="rv wdth-cvr flx-ctr">
    <div class="wdth-cvr flx-drt-cln">
        <div class="wdth-cvr flx-ctr">
            <div style="gap: 16px;" class="wdth-cvr flx-ctr flx-lft">
                <div class="flx-ctr">
                    <span style="--fgr-sz: 36px;" class="fgr ovrfl-hdn bdr-rds-cvr">
                        <img src="{{review.sender.photo.url}}">
                    </span>
                </div>
                <div class="flx-ctr">
                    <div class="flx-drt-cln flx-tp">
                        <div class="flx-ctr">
                            <span>{{review.sender.name}}</span>
                        </div>
                        <div class="snd-dt flx-ctr">
                            <h6>{{review.created|date:"j F Y"}}</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="wdth-cvr flx-ctr">
            <div class="wdth-cvr flx-ctr flx-lft">
                <div class="strs flx-ctr">
                    <div class="flx-ctr">
                        <span style="--fgr-sz: 16px;" class="fgr">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M8.00004 11.5133L12.12 14L11.0267 9.31334L14.6667 6.16001L9.87337 5.75334L8.00004 1.33334L6.12671 5.75334L1.33337 6.16001L4.97337 9.31334L3.88004 14L8.00004 11.5133Z"
                                    fill="#E85749" />
                            </svg>
                        </span>
                    </div>
                    <div class="flx-ctr">
                        <span style="--fgr-sz: 16px;" class="fgr">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M8.00004 11.5133L12.12 14L11.0267 9.31334L14.6667 6.16001L9.87337 5.75334L8.00004 1.33334L6.12671 5.75334L1.33337 6.16001L4.97337 9.31334L3.88004 14L8.00004 11.5133Z"
                                    fill="#E85749" />
                            </svg>
                        </span>
                    </div>
                    <div class="flx-ctr">
                        <span style="--fgr-sz: 16px;" class="fgr">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M8.00004 11.5133L12.12 14L11.0267 9.31334L14.6667 6.16001L9.87337 5.75334L8.00004 1.33334L6.12671 5.75334L1.33337 6.16001L4.97337 9.31334L3.88004 14L8.00004 11.5133Z"
                                    fill="#E85749" />
                            </svg>
                        </span>
                    </div>
                    <div class="flx-ctr">
                        <span style="--fgr-sz: 16px;" class="fgr">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M8.00004 11.5133L12.12 14L11.0267 9.31334L14.6667 6.16001L9.87337 5.75334L8.00004 1.33334L6.12671 5.75334L1.33337 6.16001L4.97337 9.31334L3.88004 14L8.00004 11.5133Z"
                                    fill="#E85749" />
                            </svg>
                        </span>
                    </div>
                    <div class="flx-ctr">
                        <span style="--fgr-sz: 16px;" class="fgr">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M8.00004 11.5133L12.12 14L11.0267 9.31334L14.6667 6.16001L9.87337 5.75334L8.00004 1.33334L6.12671 5.75334L1.33337 6.16001L4.97337 9.31334L3.88004 14L8.00004 11.5133Z"
                                    fill="#E85749" />
                            </svg>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="txt wdth-cvr flx-ctr">
            <div class="wdth-cvr flx-ctr flx-lft">
                <span>{{review.comment}}</span>
            </div>
        </div>
        <div class="wdth-cvr flx-ctr">
            <div class="wdth-cvr flx-ctr flx-lft">
                <div class="flx-ctr">
                    <button type="button" class="btn-lk-rv flx-ctr" id="btn-lk-rv-{{review.id}}">
                        <div class="flx-ctr">
                            <span style="--fgr-sz: 18px;" class="fgr">
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="{% if review.id in user_profile_wishlist_reviews %}#E85749{% else %}none{% endif %}" id="svg-{{review.id}}"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_98_56)">
                                        <path
                                            d="M9 15.1875C9 15.1875 1.96875 11.25 1.96875 6.46876C1.96875 5.62352 2.2616 4.80439 2.79747 4.15073C3.33334 3.49708 4.07913 3.04927 4.90795 2.88351C5.73677 2.71774 6.59743 2.84426 7.34348 3.24153C8.08954 3.6388 8.67491 4.28229 9 5.06251C9.32509 4.28229 9.91046 3.6388 10.6565 3.24153C11.4026 2.84426 12.2632 2.71774 13.092 2.88351C13.9209 3.04927 14.6667 3.49708 15.2025 4.15073C15.7384 4.80439 16.0312 5.62352 16.0312 6.46876C16.0312 11.25 9 15.1875 9 15.1875Z"
                                            stroke="#E85749" stroke-width="1.5" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                    </g>
                                    <defs>
                                        <clipPath id="clip0_98_56">
                                            <rect width="18" height="18" fill="white" />
                                        </clipPath>
                                    </defs>
                                </svg>
                            </span>
                        </div>
                        {% if review.user_profile_favorite_review.all|count > 0 %}
                        <div style="height: 14px;" class="lks-cnt flx-ctr">
                            <h6>{{review.user_profile_favorite_review.all|count}}</h6>
                        </div>
                        {% endif %}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var buttonLike = document.getElementById("btn-lk-rv-{{review.id}}");

        if (buttonLike) {
            buttonLike.addEventListener('click', function (e) {
                e.preventDefault();
                var data = {
                    sender_id: "{{user.id}}",
                    review_id: "{{review.id}}",
                };
                fetch("{% url 'forms:like-review' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{csrf_token}}',
                    },
                    body: JSON.stringify(data)
                })
                    .then(response => response.json())
                    .then(data => {
                        var svg = document.getElementById("svg-{{review.id}}");
                        var likeCount = this.querySelector(".lks-cnt");
                        if (data.is_liked) {
                            svg.removeAttribute("fill");
                            svg.setAttribute("fill", "#E85749");
                            if (!likeCount) {
                                this.insertAdjacentHTML('beforeend', `
                                    <div style="height: 14px;" class="lks-cnt flx-ctr">
                                        <h6>1</h6>
                                    </div>
                                `);
                            }
                            else {
                                likeCount.textContent = likeCount + 1;
                            }
                        }
                        else if (data.is_removed) {
                            var likes = "{{review.user_profile_favorite_review.all|count}}";
                            var is_liked = "{% if review.id in user_profile_wishlist_reviews %}1{% else %}0{% endif %}";
                            svg.removeAttribute("fill");
                            svg.setAttribute("fill", "none");
                            if (likes == "1" && is_liked == "1") {
                                likeCount.remove();
                            }
                            else if (likes == "0" && is_liked == "0") {
                                likeCount.remove();
                            }
                            else if (likes > 1) {
                                likeCount.textContent = likeCount - 1;
                            }
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
            });
        }
    });
</script>